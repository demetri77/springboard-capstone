---
title: "Banking Capstone - Machine Learning Applied"
author: "Demetri Lee"
date: "December 27, 2018"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(caret)
knitr::opts_chunk$set(echo = TRUE)
```

## Trying to predict the success of bank telemarketing

I'm trying to predict the success of telemarketing calls for a bank that's 
selling long-term deposits. A Portuguese retail bank was addressed, with data 
collected from 2008 to 2013, thus including the effects of the recent 
financial crisis of 2008. With 21 features available for analysis, I hope to 
derive knowledge for a model that would confirm how to better focus resources 
towards clients with a high chance of agreeing to registering for extra 
banking services. 

```{r}
bankfull_clean <- read_csv("bankfull_clean.csv", col_types = "ifffffffffiiiicdddddffd")
```

I will be treating this a supervised classification problem. While predicting 
whether a customer will subscribe to a new service, I need to find the main 
predictors while developing a model that best expressses a client's decision 
for subscribing. 

## Set Up Model Parameters

caret::trainControl(method = "cv", number = 2, classProbs = TRUE)

Let's start with partitioning the dataset into a training and test set.
```{r}
set.seed(13456)
inTrain <- createDataPartition(y=bankfull_clean$subscribed, p=0.75, list=FALSE)
trainData <- bankfull_clean[ inTrain,]
testData  <- bankfull_clean[-inTrain,]

x = trainData[,]
y = trainData$subscribed

```

## Logistic Regression with CARET

Develop a model for training data. 
```{r}

# applying preProcess to scale/standardize/normalize
#preProcess_missingdata <- preProcess(trainData, method='knnImpute')
#preprocessed <- preProcess(trainData, method=c("scale"))

# develop a model
modelFit <- train(subscribed ~ ., data=trainData, method="glm", na.action=na.omit)

```

What can we conclude from the logistic regression model? 
```{r}
summary(modelFit)
```


Let's apply our model to the test set.
```{r}

glm_prediction <- predict(modelFit, newdata=testData)
```

Here is a confusion matrix, with the results expressing accuracy, sensitivity, 
and specificity.
```{r}
confMatrix <- caret::confusionMatrix(glm_prediction, testData$subscribed, mode="everything") 
#confMatrix

# use metric parameter; F1 or Kappa

# investigate further parameters (eg F1/accuracy score)
# Precision = TP / (TP + FP)
# Recall = TP / (TP + FN)
# F1 = (1+beta^2)*precision*recall/((beta^2 * precision)+recall)
# confMatrix$byClass["F1"]

```



```{r}
#dummyModel <- dummyVars(subscribed~.,data=bankfull_clean)
#trainData_mat <- predict(dummyModel, newdata = trainData)
#trainData <- data.frame(trainData_mat)
```

## Random Forest with CARET
```{r}
# play with smaller # of rf while playing/testing
rf_model <- caret::train(subscribed~., data=trainData, method="rf",
                         trControl=trainControl(method="cv", number=5))

rf_model
#rf_prediction <- predict(_modelFit_, newdata=testData)
```


