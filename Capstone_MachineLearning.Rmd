---
title: "Banking Capstone - Machine Learning Applied"
author: "Demetri Lee"
date: "December 27, 2018"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(caret)
knitr::opts_chunk$set(echo = TRUE)
```

## Trying to predict the success of bank telemarketing

I'm trying to predict the success of telemarketing calls for a bank that's 
selling long-term deposits. A Portuguese retail bank was addressed, with data 
collected from 2008 to 2013, thus including the effects of the recent 
financial crisis of 2008. With 21 features available for analysis, I hope to 
derive knowledge for a model that would confirm how to better focus resources 
towards clients with a high chance of agreeing to registering for extra 
banking services. 

```{r}
bankfull_clean <- read_csv("bankfull_clean.csv", col_types = "ifffffffffiiiicdddddffd")
#bankfull_clean <- read_delim(file = "bank-additional.csv", delim = ";", col_types = "iccccccccciiiicdddddc")
```

I will be treating this a supervised classification problem. While predicting 
whether a customer will subscribe to a new service, I need to find the main 
predictors while developing a model that best expressses a client's decision 
for subscribing. 

## Logistic Regression
Let's start with partitioning the dataset into a training and test set.
```{r}
set.seed(13456)
inTrain <- createDataPartition(y=bankfull_clean$subscribed, p=0.75, list=FALSE)
trainData <- bankfull_clean[ inTrain,]
testData  <- bankfull_clean[-inTrain,]

x = trainData[,]
y = trainData$subscribed

```

Now to transform the data before developing a model for training. 
```{r}

# applying preProcess
#preProcess_missingdata <- preProcess(trainData, method='knnImpute')
#preprocessed <- preProcess(trainData, method=c("scale"))

# develop a model
modelFit <- train(subscribed ~ ., data=trainData, method="glm", na.action = na.omit)

```

Now that we have a model, let's apply it to the test set.
```{r}

predictions <- predict(modelFit, newdata=testData)

```

Here is a confusion matrix, with the results expressing accuracy, sensitivity, 
and specificity.
```{r}
confusionMatrix(predictions, testData$subscribed) # investigate further parameters (eg F1 score)
```



```{r}
dummyModel <- dummyVars(subscribed~.,data=bankfull_clean)
trainData_mat <- predict(dummyModel, newdata = trainData)
trainData <- data.frame(trainData_mat)
```

## Random Forest
```{r}
library(randomForest)
n <- nrow(bankfull_clean)

rf.train.1 <- bankfull_clean[1:n, c("age", "edu_lvl")]
rf.label <- as.factor(bankfull_clean$subscribed)

set.seed(1234)
rf.1 <- randomForest(x=rf.train.1, y=rf.label, importance=TRUE, ntree=500)
rf.1

varImpPlot(rf.1)

rf_model <- caret::train(subscribed~., data=bankfull_clean, method="rf")

```

